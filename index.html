function wait(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

    // Run
    async function onRun() {
      const fullName = nameInput.value.trim();
      if (!fullName) { alert('Type a full name first.'); return; }
      const queries = buildQueries(fullName);
      renderPlanned(queries);
      resultsEl.innerHTML = 'Searching...';
      const allQueries = [].concat(queries.cooccurrence, queries.discovery, queries.standalone);
      const sections = [];
      for (const q of allQueries) {
        try {
          const items = await braveSearch(q);
          sections.push({ q, items });
        } catch (err) {
          sections.push({ q, items: [], error: String(err) });
        }
        await wait(1000); // 1 req/sec
      }
      resultsEl.innerHTML = sections.map(function (sec) {
        const header = '<div class="row"><strong>Query:</strong> <code>' + sec.q + '</code></div>';
        if (sec.error) return header + '<div class="row muted">Error: ' + sec.error + '</div>';
        if (!sec.items.length) return header + '<div class="row muted">No results.</div>';
        const list = sec.items.map(function (it) {
          return '<div class="row">'
            + '<a href="' + it.link + '" target="_blank" rel="noopener">' + it.title + '</a>'
            + '<div class="muted">' + it.snippet + '</div>'
            + '</div>';
        }).join('');
        return header + list;
      }).join('');
    }

    // Events
    nameInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') onRun();
    });
    runBtn.addEventListener('click', onRun);

    // Initial render
    renderFilters();
  });
  </script>
</body>
</html>
