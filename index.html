<script>
  // Flagged keywords to check co-occurrences with:
  const FLAGGED = [
    'Orbán Viktor',
    'Tisza party',
    'Fidesz party',
    'Magyar Péter'
  ];

  // Additional discovery terms:
  const DISCOVERY = [
    'Google Scholar',
    'ORCID',
    'ResearchGate',
    'LinkedIn',
    'Twitter',
    'Facebook',
    'Instagram',
    'publications'
  ];

  const nameInput = document.getElementById('nameInput');
  const runBtn = document.getElementById('runBtn');
  const plannedEl = document.getElementById('planned');
  const resultsEl = document.getElementById('results');

  function buildQueries(fullName) {
    const quoted = '"' + fullName.trim() + '"';
    const cooccurrence = FLAGGED.map(function (k) { return quoted + ' "' + k + '"'; });
    const discovery = DISCOVERY.map(function (k) { return quoted + ' ' + k; });
    return { cooccurrence: cooccurrence, discovery: discovery, standalone: [quoted] };
  }

  function renderPlanned(qs) {
    function makeList(title, arr) {
      return '<div class="row"><strong>' + title + ':</strong> '
        + arr.map(function (q) { return '<code>' + q + '</code>'; }).join(' · ')
        + '</div>';
    }
    plannedEl.innerHTML =
      makeList('Co-occurrence', qs.cooccurrence) +
      makeList('Discovery', qs.discovery) +
      makeList('Standalone', qs.standalone);
  }

  // Call the Netlify proxy; no token in the browser
  async function braveSearch(q) {
    const res = await fetch('/api/search?q=' + encodeURIComponent(q));
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    return data.items || [];
  }

  async function onRun() {
    const fullName = nameInput.value.trim();
    if (!fullName) { alert('Type a full name first.'); return; }

    const queries = buildQueries(fullName);
    renderPlanned(queries);
    resultsEl.innerHTML = 'Searching...';

    const allQueries = []
      .concat(queries.cooccurrence)
      .concat(queries.discovery)
      .concat(queries.standalone);

    const sections = [];
    for (const q of allQueries) {
      try {
        const items = await braveSearch(q);
        sections.push({ q: q, items: items });
      } catch (err) {
        sections.push({ q: q, items: [], error: String(err) });
      }
    }

    resultsEl.innerHTML = sections.map(function (sec) {
      const header = '<div class="row"><strong>Query:</strong> <code>' + sec.q + '</code></div>';
      if (sec.error) return header + '<div class="row muted">Error: ' + sec.error + '</div>';
      if (!sec.items.length) return header + '<div class="row muted">No results.</div>';
      const list = sec.items.map(function (it) {
        return '<div class="row">' +
          '<a href="' + it.link + '" target="_blank" rel="noopener">' + it.title + '</a>' +
          '<div class="muted">' + it.snippet + '</div>' +
        '</div>';
      }).join('');
      return header + list;
    }).join('');
  }

  // Enter key triggers search
  nameInput.addEventListener('keydown', function (e) {
    if (e.key === 'Enter') onRun();
  });
  runBtn.addEventListener('click', onRun);
</script>
